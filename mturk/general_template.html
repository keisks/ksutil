<script type='text/javascript'
        src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.1/bootstrap-slider.js"></script>

<style>

    body {
        font-family: 'Helvetica', 'Arial', sans-serif;
        color: #444444;
        font-size: 12pt;
        background-color: #FAFAFA;
    }

    mark {
        /*background-color: #cafad5;*/
        background-color: transparent;
        color: black;
        padding-left: 3px;
        padding-right: 3px;

    }

    ul {
        text-align: left;
        list-style-position: inside;
    }

    textarea {
        font-size: 18px;
        margin: 0 auto;
        display: block;
        resize: none;
    }


    #submitButton {
        margin: auto;
        display: block;
        width: auto;
        background-color: #2172a4;
        color: #fff;
        font-size: 20pt;
        padding: .5rem;
        cursor: pointer;
        border-radius: .75rem;
    }

    #submitButton:hover {
        background-color: #06486F;
    }

    table {
        border-spacing: 5px;
    }

    td.min {
        width: 1%;
        white-space: nowrap;
    }

    .examples {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.2s ease-out;
    }

    .accordion {
        background-color: #eee;
        color: #444;
        cursor: pointer;
        padding: 18px;
        width: 100%;
        border: none;
        text-align: left;
        outline: none;
        font-size: 15px;
        transition: 0.4s;
    }

    .active, .accordion:hover {
        background-color: #ccc;
    }

    .accordion:after {
        content: '\002B';
        color: #777;
        font-weight: bold;
        float: right;
        margin-left: 5px;
    }

    .active:after {
        content: "\2212";
    }

    .panel {
        padding: 0 18px;
        background-color: white;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.2s ease-out;
    }

    /************************************
    SLIDER STYLING
    Taken from: https://www.w3schools.com/howto/howto_js_rangeslider.asp
    ************************************/
    .slidecontainer {
        width: 50%; /* Width of the outside container */
        display: block;
        margin: auto;
        position: relative;
    }
    .slidecontainer:before {
        content: "\2796";
        position: absolute;
        left: -2rem;
        top: 0;
    }
    .slidecontainer:after {
        content: '\02795';
        position: absolute;
        right: -2rem;
        top: 0;
    }

    /* The slider itself */
    .slider {
        -webkit-appearance: none;  /* Override default CSS styles */
        appearance: none;
        background-size: 95%;
        background-repeat: no-repeat;
        background-position: center;
        width: 100%; /* Full-width */
        height: 1rem;
        outline: none; /* Remove outline */
        opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
        -webkit-transition: .2s; /* 0.2 seconds transition on hover */
        transition: opacity .2s;
    }

    /* Mouse-over effects */
    .slider:hover {
        opacity: 1; /* Fully shown on mouse-over */
    }

    /* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
    .slider::-webkit-slider-thumb {
        -webkit-appearance: none; /* Override default look */
        appearance: none;
        width: 2.1rem; /* Set a specific slider handle width */
        height: 2.1rem;
        border-radius: 50%;
        background: #06486F;
        cursor: pointer; /* Cursor on hover */
    }

    .slider::-moz-range-thumb {
        width: 2.1rem; /* Set a specific slider handle width */
        height: 2.1rem;
        border-radius: 50%;
        background: #06486F;
        cursor: pointer; /* Cursor on hover */
    }

    .sliderticks {
        display: flex;
        justify-content: space-between;
        padding: 0 10px;
    }

    .sliderticks p {
        position: relative;
        display: flex;
        justify-content: center;
        text-align: center;
        width: 1px;
        background: #D3D3D3;
        height: 10px;
        line-height: 40px;
        margin: 0 0 20px 0;
    }



</style>

<script>

    function init() {

        // do something initially (if necessary)
        // verification button
        $('.btn').click(function () {
            verification();
        });

        // slider
        var slider = document.getElementById("mySlider");
        var output = document.getElementById("sliderValue");
        output.innerHTML = slider.value;

        slider.oninput = function() {
            output.innerHTML = this.value;
        }
    }

    // below some useful (?) functions
    function verification() {
        console.log("verification");
        var verified = false;

        if (verified) {
            alert("not verified!!");
            return false;
        }

        var elementid = document.getElementById("elementid").value;

        // if api call is necessary, here is an example
        var data = {"question": sent, "option1": option1, "option2": option2, "conj": conj, "answer": rev_answer};
        var bert_feedback = document.getElementById("bert_feedback");

        console.log("data: "+JSON.stringify(data));
        bert_feedback.innerHTML = 'Now checking... ... ... Wait for a moment.';

        var bert_fail = false;

        $.ajax({
            url: url,
            type: "POST",
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(data),
            success: function (data) {
                var result = data;
                console.log("result: "+ JSON.stringify(result));
                if (result["bert_solved"]){
                    console.log("bert solved");
                    alert("Our system predicted your answer! Please write a different answer.");
                    bert_feedback.innerHTML = '<span style="color: red;">Our system predited your answer! Please write a different answer (e.g., adding more context will be helpful in general).';
                } else {
                    console.log("bert failed");
                    bert_feedback.innerHTML = '<span style="color: blue;">Your answer looks good, ready to submit!';
                    bert_fail = true;
                }
                document.getElementById("apibutton").disabled = false;
            },
            error: function (err) {
                console.error(err);
                alert("The validation went something wrong. If you keep seeing this message many times, please contact the requester. Sorry for the inconvenience.")
                bert_fail = false;
                document.getElementById("apibutton").disabled = false;
            }

        });
    }

    function guidGenerator() {
        var S4 = function() {
            return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
        };
        return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
    }


    function validateAnswerSentences(){
        console.log("validateAnswerSentences");

        // list of personal pronouns
        var prp = ["i", "my", "me", "me.", "me,", "mine", "mine.", "myself", "myself.", "you", "you.", "your", "yours", "yours.", "yourself", "yourself.", "he", "his", "him", "him.", "him,", "himself", "himself.", "himself,", "she", "her", "her.", "her,", "hers", "herself.", "herself,", "herself", "we", "our", "us", "us.", "us,", "ours", "ours."];


        // shared variables
        var name1 = document.getElementById("option1").value;
        var name2 = document.getElementById("option2").value;


        // validate end1
        var answer_rhs = document.getElementById("answer_rhs").value.trim();
        var rhs_sent_tokens = answer_rhs.split(' ');
        var rhs_sent_len = answer_rhs.split(' ').length;
        //var normalized_lhs = answer_lhs.replace(name2, "#");
        //console.log(normalized_lhs);

        // check if name1 and name2 are not included in answer_rhs
        if (answer_rhs.includes(name1) || answer_rhs.includes(name2)){
            alert("In this HIT, your answer must not include any person's name.");
            return false;
        }

        if  (rhs_sent_len <= 5) {
            alert("Your answer looks too short. Please make sure that your answer has more than 5 words.");
            return false;
        }

        if  (rhs_sent_len >= 15) {
            alert("Your answer looks too long. Please make sure that your answer has fewer than 15 words.");
            return false;
        }

        if (! answer_rhs.endsWith('.')){
            alert("Your sentence must end with '.'");
            return false;
        }

        if (answer_rhs.includes('"')){
            alert("Your answer contains a double quote. Please avoid using it. Thank you.");
            return false;
        }


        for (var i=0; i<rhs_sent_len; i++){
            if (prp.includes(rhs_sent_tokens[i].toLowerCase())){
                alert("Your answer includes a personal pronoun. Please read the instructions.");
                return false;
            }
        }

        return true;

    }

    function isValid() {
        if (validateAnswerSentences()){
            if (bert_fail) {
                return true;
            } else {
                alert("Your answer needs to be verified before submission (click the blue button above to check. Thank you.");
                document.getElementById("apibutton").disabled = false;
                return false;
            }
        } else {
            document.getElementById("apibutton").disabled = false;
            return false;
        }
    }

    function toggle() {
        var examples = document.getElementsByClassName("examples")[0];
        console.log(examples);
        if (examples.style.maxHeight){
            examples.style.maxHeight = null;
        } else {
            examples.style.maxHeight = examples.scrollHeight + "px";
        }
    }

</script>

</head>

<body onload="init()">
<form name='mturk_form' method='post' id='mturk_form' action='/mturk/externalSubmit'
      onsubmit="return isValid()">
    <input type='hidden' value='' name='assignmentId' id='assignmentId'/>

    <div class="container">
        <!-- Title -->
        <h1 align="center">This is the greatest HIT!<br/></h1>
        <h4 align="center">Please read the instructions carefully.</h4>


        <button type="button" class="accordion"><span style="font-size: x-large ">Instructions</span></button>
        <div class="panel">
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            <ol>
                <li>
                    rule 1
                </li>
                <li>
                    rule 2
                </li>
            </ol>

        </div>

        <button type="button" class="accordion"><span style="font-size: x-large ">Examples</span></button>
        <div class="panel">
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>

        <hr/>

        <h3 align="left">Question</h3>

        <!-- put hidden variables such as -->
        <input type='hidden' value="${qID}" name='qID' id='qID'/>

        <div style="width:1024px; margin:0 auto;">

            <p> Questions come here.</p>
            <!--
            <p> Your answer must include the following participant's name:<span class="participant"><b> ${option2} </b></span> (Possessive form is allowed.)</p>
            <p> Please make sure that your answer does NOT sound plausible when the two participants in the blue boxes are swapped. (See the example above.)</p>
            -->

            <table class="table table-bordered">
                <tbody>
                <tr>
                    <td style="vertical-align:middle;">
                        textarea type question
                    </td>
                    <td style="border:3px solid blue;">
                        <textarea id="workers_answer" class="form-control" cols="50" name="workers_answer" rows="1"></textarea>
                    </td>
                </tr>

                </tbody>
            </table>

            <hr/>

            <!-- Select Basic -->
            <div class="form-group">
                <label class="col-md-12 control-label" for="selectbasic">Select Basic</label>
                <div class="col-md-12">
                    <select id="selectbasic" name="selectbasic" class="form-control">
                        <option value="1">Option one</option>
                        <option value="2">Option two</option>
                    </select>
                </div>
            </div>
            <br />
            <hr />
            <br />

            <!-- Multiple Radios -->

            <div class="form-group">
                <label class="col-md-12 control-label" for="radios">Multiple Radios</label>
                <div class="col-md-12">
                    <div class="radio">
                        <label for="radios-0">
                            <input type="radio" name="radios" id="radios-0" value="1" checked="checked">
                            Option one
                        </label>
                    </div>
                    <div class="radio">
                        <label for="radios-1">
                            <input type="radio" name="radios" id="radios-1" value="2">
                            Option two
                        </label>
                    </div>
                </div>
            </div>
            <br />
            <hr />
            <br />

            <!-- Multiple Checkboxes -->
            <div class="form-group">
                <label class="col-md-12 control-label" for="checkboxes">Multiple Checkboxes</label>
                <div class="col-md-12">
                    <div class="checkbox">
                        <label for="checkboxes-0">
                            <input type="checkbox" name="checkboxes" id="checkboxes-0" value="1">
                            Option one
                        </label>
                    </div>
                    <div class="checkbox">
                        <label for="checkboxes-1">
                            <input type="checkbox" name="checkboxes" id="checkboxes-1" value="2">
                            Option two
                        </label>
                    </div>
                </div>
            </div>
            <br />
            <hr />
            <br />

            <!-- Multiple Checkboxes (inline) -->
            <div class="form-group">
                <label class="col-md-12 control-label" for="checkboxes">Inline Checkboxes</label>
                <div class="col-md-12">
                    <label class="checkbox-inline" for="checkboxes-0">
                        <input type="checkbox" name="checkboxes" id="checkboxes-0" value="1">
                        1
                    </label>
                    <label class="checkbox-inline" for="checkboxes-1">
                        <input type="checkbox" name="checkboxes" id="checkboxes-1" value="2">
                        2
                    </label>
                    <label class="checkbox-inline" for="checkboxes-2">
                        <input type="checkbox" name="checkboxes" id="checkboxes-2" value="3">
                        3
                    </label>
                    <label class="checkbox-inline" for="checkboxes-3">
                        <input type="checkbox" name="checkboxes" id="checkboxes-3" value="4">
                        4
                    </label>
                </div>
            </div>
            <br />
            <hr />
            <br />

            <!-- Multiple Radios (inline) -->
            <div class="form-group">
                <label class="col-md-12 control-label" for="radios">Inline Radios</label>
                <div class="col-md-12">
                    <label class="radio-inline" for="radios-0">
                        <input type="radio" name="radios" id="radios-0" value="1" checked="checked">
                        1
                    </label>
                    <label class="radio-inline" for="radios-1">
                        <input type="radio" name="radios" id="radios-1" value="2">
                        2
                    </label>
                    <label class="radio-inline" for="radios-2">
                        <input type="radio" name="radios" id="radios-2" value="3">
                        3
                    </label>
                    <label class="radio-inline" for="radios-3">
                        <input type="radio" name="radios" id="radios-3" value="4">
                        4
                    </label>
                </div>
            </div>


            <br />
            <hr />
            <br />


            <div class="slidecontainer">
                <input type="range" min="-3" max="3" value="0" class="slider" id="mySlider" style="background-color: darkgrey;">
                <div class="sliderticks">
                    <p>-3</p>
                    <p>-2</p>
                    <p>-1</p>
                    <p>0</p>
                    <p>1</p>
                    <p>2</p>
                    <p>3</p>
                </div>
                <p style="color: deeppink; text-align:center";>Your choice: <span id="sliderValue" style="font-weight: bolder">0</span></p>
            </div>


            <p>Comments and feedback
                (Please leave a comment if you have any questions, suggestions, etc.)</p>
            <span><textarea class="form-control" cols="120" name="Comments" rows="5"></textarea></span>
            <br/>

        </div>
    </div>

    <div align="center">
        <p>
            <button id="apibutton" name="apibutton" type="button" class="btn btn-primary" onclick="this.disabled=true;">Verify your answer before submission.</button>
        </p>
        <p>The verification may take around 5 seconds. Thank you for your patience.</p>
    </div>

    <p align="center">
    <div align="center" id="bert_feedback"></div>
    </p>

    <p align="center">
        <input type='submit' id='submitButton' value='Submit'/>
    </p>
</form>

<script language='Javascript'>turkSetAssignmentID();</script>
<script>
    // accordion
    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight){
                panel.style.maxHeight = null;
            } else {
                panel.style.maxHeight = panel.scrollHeight + "px";
            }
        });
    }

</script>


</body>
